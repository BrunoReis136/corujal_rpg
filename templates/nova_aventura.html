{% extends "base.html" %}

{% block title %}
  {% if editando %}Editar Aventura{% else %}Nova Aventura{% endif %} - RPG
{% endblock %}

{% block content %}
<div class="flex flex-col items-center justify-center h-full">
  <h2 class="text-2xl font-bold text-yellow-300 mb-6">
    {% if editando %}‚úèÔ∏è Editar Aventura{% else %}‚ú® Criar Nova Aventura{% endif %}
  </h2>

  <div class="bg-gray-800 p-6 rounded-xl shadow-lg w-full max-w-lg">
    <form method="post" class="space-y-4">
      {{ form.hidden_tag() }}

      <!-- t√≠tulo -->
      <div>
        {{ form.titulo.label(class="block mb-1 text-yellow-300") }}
        {{ form.titulo(class="w-full p-2 rounded-lg bg-gray-700 text-white") }}
        {% for error in form.titulo.errors %}
          <span class="text-red-400 text-sm">{{ error }}</span>
        {% endfor %}
      </div>

      <!-- descri√ß√£o -->
      <div>
        {{ form.descricao.label(class="block mb-1 text-yellow-300") }}
        {{ form.descricao(class="w-full p-2 rounded-lg bg-gray-700 text-white") }}
        {% for error in form.descricao.errors %}
          <span class="text-red-400 text-sm">{{ error }}</span>
        {% endfor %}
      </div>

      <!-- cen√°rio -->
      <div>
        {{ form.cenario.label(class="block mb-1 text-yellow-300") }}
        {{ form.cenario(class="w-full p-2 rounded-lg bg-gray-700 text-white") }}
        {% for error in form.cenario.errors %}
          <span class="text-red-400 text-sm">{{ error }}</span>
        {% endfor %}
      </div>

      <!-- status -->
      <div>
        {{ form.status.label(class="block mb-1 text-yellow-300") }}
        {{ form.status(class="w-full p-2 rounded-lg bg-gray-700 text-white") }}
      </div>

      <!-- regras -->
      <div>
        <label class="block mb-2 text-yellow-300 text-lg font-bold">üé≤ Regras de Rolagem de Dados</label>
      
        <div class="flex flex-col gap-3">
          <div>
            <label class="block text-gray-300 text-sm mb-1 flex items-center gap-2">
              üíÄ Erro Cr√≠tico (m√°x.)
            </label>
            {{ form.erro_critico_max(class="w-full p-2 rounded-lg bg-gray-700 text-white") }}
          </div>
      
          <div>
            <label class="block text-gray-300 text-sm mb-1 flex items-center gap-2">
              ‚ùå Erro Normal (m√°x.)
            </label>
            {{ form.erro_normal_max(class="w-full p-2 rounded-lg bg-gray-700 text-white") }}
          </div>
      
          <div>
            <label class="block text-gray-300 text-sm mb-1 flex items-center gap-2">
              ‚úÖ Acerto Normal (m√°x.)
            </label>
            {{ form.acerto_normal_max(class="w-full p-2 rounded-lg bg-gray-700 text-white") }}
          </div>
      
          <div>
            <label class="block text-gray-300 text-sm mb-1 flex items-center gap-2">
              üåü Acerto Cr√≠tico (m√≠n.)
            </label>
            {{ form.acerto_critico_min(class="w-full p-2 rounded-lg bg-gray-700 text-white") }}
          </div>
        </div>
      
        <p class="text-xs text-gray-400 mt-2">
          ‚öôÔ∏è As faixas de valores ser√£o ajustadas automaticamente para manter consist√™ncia (1‚Äì100).
        </p>
      </div>




      <!-- bot√µes -->
      <div class="flex gap-4">
        {{ form.submit(class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg") }}
        <a href="{{ url_for('lista_aventuras') }}"
           class="flex-1 text-center bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">
          ‚Ü©Ô∏è Voltar
        </a>
      </div>
    </form>
  </div>
</div>
{% endblock %}



{% block scripts %}

<script>
document.addEventListener("DOMContentLoaded", () => {
  const erroCritico = document.getElementById("erro_critico_max");
  const erroNormal = document.getElementById("erro_normal_max");
  const acertoNormal = document.getElementById("acerto_normal_max");
  const acertoCritico = document.getElementById("acerto_critico_min");

  function ajustarValores() {
    let eCrit = parseInt(erroCritico.value) || 15;
    let eNorm = parseInt(erroNormal.value) || (eCrit + 30);
    let aNorm = parseInt(acertoNormal.value) || (eNorm + 35);
    let aCrit = parseInt(acertoCritico.value) || (aNorm + 1);

    // Garantir ordem l√≥gica
    if (eNorm <= eCrit) eNorm = eCrit + 1;
    if (aNorm <= eNorm) aNorm = eNorm + 1;
    if (aCrit <= aNorm) aCrit = aNorm + 1;

    // Limites m√°ximos
    if (aCrit > 100) aCrit = 100;
    if (aNorm > 99) aNorm = 99;
    if (eNorm > 98) eNorm = 98;

    erroCritico.value = eCrit;
    erroNormal.value = eNorm;
    acertoNormal.value = aNorm;
    acertoCritico.value = aCrit;
  }

  [erroCritico, erroNormal, acertoNormal, acertoCritico].forEach(el => {
    el.addEventListener("input", ajustarValores);
  });

  ajustarValores(); // inicial
});
</script>


{% endblock %}

